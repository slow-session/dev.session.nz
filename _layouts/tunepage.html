---
layout: page
---
<div class="row small-up-1 medium-up-2 large-up-2">
<div class="small-6 columns">
    {{ page.key }} {{ page.rhythm }}, added
    <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%-d %B %Y" }}</time>
    {% if page.location %}
    <br />Played in: {{ page.location }}
    {% endif %}
    {% if page.notes %}
    <p>Notes: {{ page.notes }}</p>
    {% endif %}
</div>
<div class="small-6 columns">
    {% if page.location contains 'Wellington' %}
    {% if page.slowtuneoftheweek %}
    Slow Session:
    <time datetime="{{ page.slowtuneoftheweek | date_to_xmlschema }}">{{ page.slowtuneoftheweek | date: "%-d %B %Y" }}</time>
    {% elsif page.tags contains 'slowsession' %}
    Slow Session: before 2017
    {% endif %}
    <br />
    {% endif %}
    {% if page.location contains 'Wellington' and page.regtuneoftheweek %}
    Regular Session:
    <time datetime="{{ page.regtuneoftheweek | date_to_xmlschema }}">{{ page.regtuneoftheweek | date: "%-d %B %Y" }}</time>
    <br />
    {% endif %}
</div>
</div>
<br />

<div id="audioPlayer"></div>
<div style="overflow-x:auto;">
<div id="showPlayer"></div>
</div>

<!-- *** loop presets *** -->
<form id="loopForm" style="display: none;">
    <input type="button" class="filterButton" value="Show Preset Loops" onclick="toggleLoops(this);">
</form>
<div id="loopPresetControls" style="display: none;"></div>

<div class="outputABC">
    <div id="paper0" style="display: block;"></div>
    {% if page.abc contains "K:" %}
    <!--<h2>Play the ABC version</h2>-->

    <div style="overflow-x:auto;">
    <div id="ABCplayer"></div>
    </div>
    {% endif %}
    <div id='abcSource' class="abcSource">
        <div class="row"></div>
        <div id="textAreas"></div>
        <p>You can edit the ABC source, and see your changes. This will <b>NOT</b> change the website directly. A brief set of instructions is found    <a href="/editingABC/">here.</a></p>
        <span title="Download the ABC you've entered. Don't lose your work!">
            <input value='Download ABC' type='button' class="filterButton"
                onclick='downloadFile(document.getElementById("filename").value, document.getElementById("textAreaABC1").value)' />
        </span>
        
        <p>If you feel that your changes are a closer match to the recording on the website, please save
        your changes (<b>Download ABC</b> button), send them to us at <a href="mailto:{{ site.email }}">{{ site.email }}</a>, and
        we will review the proposed changes.</p>            
    </div>
</div>

<!-- Area to store filename for download -->
<textarea id="filename" style="display:none;"></textarea>

<form id="showABCform">
    <input type="button" class="filterButton" value="Show ABC Source" onclick="toggle(this);">
</form>


<div>
    <br />
    {% if page.mp3_file %}
    <p>The audio for {{ page.title }} is sourced from
    {% if page.mp3_url %}
    <a href="{{ page.mp3_url }}">{{ page.mp3_source }}</a>.
    {% else %}
    {{ page.mp3_source }}.
    {% endif %}
    Permission to use is gratefully acknowledged and the audio is made available under this licence:
    {{ page.mp3_licence }}</p>

    {% if page.mp3_url %}
    <p>Original audio: <a href="{{ page.mp3_url }}">{{ page.mp3_url }}</a></p>
    <!-- If the mp3_url is one from YouTube or Facebook, embed a copy here -->
    <p><script>
    show_iframe("{{ page.mp3_url }}");
    </script>
    </p>
    {% endif %}
    {% endif %}

    {% if page.alt_mp3_url %}
    <p>Alternative version: <a href="{{ page.alt_mp3_url }}">{{ page.alt_mp3_url }}</a></p>
    <!-- If the mp3_url is one from YouTube or Facebook, embed a copy here -->
    <p>
    <script>
    show_iframe("{{ page.alt_mp3_url }}");
    </script>
    </p>
    {% endif %}

    {% if page.abc_source %}
    <p>The music notation was derived from
    {% if page.abc_url %}
    <a href="{{ page.abc_url }}">{{ page.abc_source }}</a>.</p>
    {% else %}
    {{ page.abc_source }}
    {% endif %}
    {% endif %}
</div>

<div id="debug"></div>

<!-- Show errors -->
<div id='warnings'></div>

{% assign tuneID = 1 %}
<script>
var tuneID = "{{ tuneID }}";

window.store = {
    "{{ tuneID }}": {
        "title": "{{ page.title | xml_escape }}",
        "tuneID": "{{ tuneID }}",
        "key": "{{ page.key | xml_escape }}",
        "rhythm": "{{ page.rhythm | xml_escape }}",
        "url": "{{ page.url | xml_escape }}",
        "mp3": "{{ site.mp3_host | append: page.mp3_file | xml_escape }}",
        "mp3_source": "{{ page.mp3_source | strip_html | xml_escape }}",
        "repeats": "{{ page.repeats }}",
        "parts": "{{ page.parts }}",
        "abc": {{ page.abc | jsonify }}
    },
};

function toggle(button) {
    switch (button.value) {
        case "Show ABC Source":
            button.value = "Hide ABC Source";
            document.getElementById('abcSource').style.display= "block" ;
            break;
        case "Hide ABC Source":
            button.value = "Show ABC Source";
            document.getElementById('abcSource').style.display= "none" ;
            break;
    }
}

$(document).ready(function() {
    audioPlayer.innerHTML = createAudioPlayer();

    let tuneID = "1";
    let textAreaID = "textAreaABC" + tuneID;
    
    {% if page.abc contains "K:" %}   
                
        ABCplayer.innerHTML = createABCplayer(tuneID, '{{ site.defaultABCplayer }}');

        document.getElementById('textAreas').innerHTML =
            `<textarea id="${textAreaID}" class="abcText" rows="16" 
                spellcheck="false">${store[tuneID].abc}</textarea>`;
    
        // Set the filename for downloading
        document.getElementById("filename").innerHTML =
            slugify(getABCheaderValue("T:", store[tuneID].abc)) + '.abc';

        abc_editor = new window.ABCJS.Editor(textAreaID, { paper_id: "paper0", warnings_id:"warnings", 
                    render_options: {responsive: 'resize'}, indicate_changed: "true" });
    {% endif %}

    changeTune(window.store, tuneID);

});
</script>
